<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pisces.util module &mdash; pisces 0.2.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pisces 0.2.1 documentation" href="index.html" />
    <link rel="up" title="pisces package" href="pisces.html" />
    <link rel="prev" title="pisces.request module" href="pisces.request.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pisces.request.html" title="pisces.request module"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pisces 0.2.1 documentation</a> &raquo;</li>
          <li><a href="pisces.html" accesskey="U">pisces package</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-pisces.util">
<span id="pisces-util-module"></span><h1>pisces.util module<a class="headerlink" href="#module-pisces.util" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="pisces.util.add_rows">
<tt class="descclassname">pisces.util.</tt><tt class="descname">add_rows</tt><big>(</big><em>session</em>, <em>rows</em>, <em>recurse=False</em><big>)</big><a class="reference internal" href="_modules/pisces/util.html#add_rows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pisces.util.add_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle common errors with logging in SQLAlchemy add_all.</p>
<p>Tries to add in bulk.  Failing that, it will rollback and optionally try
to add one at a time.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>session</strong> : sqlalchemy.orm.Session</p>
<p><strong>rows</strong> : list</p>
<blockquote>
<div><p>Mapped table instances.</p>
</div></blockquote>
<p><strong>recurse</strong> : bool, optional</p>
<blockquote>
<div><p>After failure, try to add records individually.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>num</strong> : int</p>
<blockquote>
<div><p>Number of objects added.  0 if none.</p>
</div></blockquote>
<p class="last"><strong>e</strong> : exception or None</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="pisces.util.db_connect">
<tt class="descclassname">pisces.util.</tt><tt class="descname">db_connect</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/pisces/util.html#db_connect"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pisces.util.db_connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect to your database.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>backend</strong> : string</p>
<blockquote>
<div><p>One of the SQLAlchemy connection strings from 
<a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_7/core/engines.html#database-urls">http://docs.sqlalchemy.org/en/rel_0_7/core/engines.html#database-urls</a></p>
</div></blockquote>
<p><strong>user</strong> : string, optional</p>
<blockquote>
<div><p>Not required for sqlite.</p>
</div></blockquote>
<p><strong>passwd</strong> : string, optional</p>
<blockquote>
<div><p>Not needed for sqlite. Prompted if needed and not provided.</p>
</div></blockquote>
<p><strong>server</strong> : string, optional</p>
<blockquote>
<div><p>Database host server.</p>
</div></blockquote>
<p><strong>port</strong> : string or integer, optional</p>
<blockquote>
<div><p>Port on remote server.</p>
</div></blockquote>
<p><strong>instance</strong> : string, optional</p>
<blockquote>
<div><p>The database instance.  For sqlite, this is the file name.</p>
</div></blockquote>
<p><strong>conn</strong> : string, optional</p>
<blockquote>
<div><p>A fully-formed SQLAlchemy style connection string.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><strong>session</strong> : bound SQLAlchemy Session instance</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>For connection string format, see:
<a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_8/core/engines.html">http://docs.sqlalchemy.org/en/rel_0_8/core/engines.html</a></p>
<p class="rubric">Examples</p>
<ol class="arabic simple">
<li>Connect to a local sqlite database file:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">,</span> <span class="n">session</span> <span class="o">=</span> <span class="n">db_connect</span><span class="p">(</span><span class="n">conn</span><span class="o">=</span><span class="s">&#39;sqlite:///mydb.sqlite&#39;</span><span class="p">)</span>
<span class="go">#or</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">,</span> <span class="n">session</span> <span class="o">=</span> <span class="n">db_connect</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s">&#39;sqlite&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="s">&#39;mydb.sqlite&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="pisces.util.gen_id">
<tt class="descclassname">pisces.util.</tt><tt class="descname">gen_id</tt><big>(</big><em>i=0</em><big>)</big><a class="reference internal" href="_modules/pisces/util.html#gen_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pisces.util.gen_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce a generator for sequential integer id values.</p>
<p class="rubric">Examples</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">lastorid</span> <span class="o">=</span> <span class="mi">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orid</span> <span class="o">=</span> <span class="n">gen_id</span><span class="p">(</span><span class="n">lastorid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orid</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orid</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">9</span>
</pre></div>
</div>
<p>Generate more than one at a time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">orid</span><span class="p">,</span> <span class="n">arid</span><span class="p">,</span> <span class="n">wfid</span> <span class="o">=</span> <span class="p">(</span><span class="n">gen_id</span><span class="p">()</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;orid&#39;</span><span class="p">,</span> <span class="s">&#39;arid&#39;</span><span class="p">,</span> <span class="s">&#39;wfid&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">orid</span><span class="o">.</span><span class="n">next</span><span class="p">(),</span> <span class="n">arid</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">(1, 1)</span>
</pre></div>
</div>
<p>Dictionary of id generators for desired ids, starting where they left off.  
ids not in Lastid will be missing</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ids</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Lastid</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Lastid</span><span class="o">.</span><span class="n">keyname</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="s">&#39;orid&#39;</span><span class="p">,</span><span class="s">&#39;arid&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">last</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="nb">id</span><span class="o">.</span><span class="n">keyname</span><span class="p">,</span> <span class="n">gen_id</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">keyvalue</span><span class="p">))</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">last</span><span class="p">[</span><span class="s">&#39;orid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">8820005</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="pisces.util.get_tables">
<tt class="descclassname">pisces.util.</tt><tt class="descname">get_tables</tt><big>(</big><em>bind</em>, <em>fulltablenames</em>, <em>metadata=None</em>, <em>primary_keys=None</em>, <em>base=None</em><big>)</big><a class="reference internal" href="_modules/pisces/util.html#get_tables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pisces.util.get_tables" title="Permalink to this definition">¶</a></dt>
<dd><p>Reflect/load an arbitrary database table as a mapped class.</p>
<p>This is a shortcut for SQLAlchemy&#8217;s declarative mapping using __table__.
See <a class="reference external" href="http://docs.sqlalchemy.org/en/rel_0_9/orm/extensions/declarative.html#using-a-hybrid-approach-with-table">http://docs.sqlalchemy.org/en/rel_0_9/orm/extensions/declarative.html#using-a-hybrid-approach-with-table</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>bind</strong> : sqlalchemy.engine.base.Engine instance</p>
<blockquote>
<div><p>Engine pointing to the target database.</p>
</div></blockquote>
<p><strong>fulltables</strong> : list of strings</p>
<blockquote>
<div><p>Of the form [&#8216;owner1.tablename1&#8217;, &#8216;owner2.tablename2&#8217;, ...]
Leave out &#8216;owner.&#8217; if database doesn&#8217;t use owners (sqlite, etc...)</p>
</div></blockquote>
<p><strong>metadata</strong> : sqlalchemy.MetaData, optional</p>
<blockquote>
<div><p>MetaData into which reflected Tables go. If not supplied, a new one
is created, accessible from MyTable.metadata on one of the loaded 
tables.</p>
</div></blockquote>
<p><strong>primary_keys</strong> : dict, optional</p>
<blockquote>
<div><p>Tablename, primary key list pairs of the form, 
{&#8216;owner1.tablename1&#8217;: [&#8216;primary_key1&#8217;, &#8216;primary_key2&#8217;]} 
These are required if the table is a view or has no primary key.</p>
</div></blockquote>
<p><strong>base</strong> : sqlalchemy.ext.declarative.api.DeclarativeMeta, optional</p>
<blockquote>
<div><p>The declarative base the from which loaded table classes will inherit.
The info dictionary of loaded Columns will be updated from those in 
the base.  These are used to generate default values and string 
representations.  Import from pisces.schema.css3, or extensions thereof.
Default, sqlalchemy.ext.declarative.api.DeclarativeMeta.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">list</p>
<blockquote>
<div><p>Corresponding list of ORM table classes mapped to reflected tables, 
Can be used for querying or making row instances.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><strong>sqlalchemy.exc.NoSuchTableError</strong> : Table doesn&#8217;t exist.</p>
<p><strong>sqlalchemy.exc.InvalidRequestError</strong> : Table already loaded in metadata.</p>
<p class="last"><strong>sqlalchemy.exc.ArgumentError</strong> : Table has no primary key(s).</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>In SQLAlchemy, a database account/owner is generally used with the &#8220;schema&#8221;
keyword argument.</p>
<p>For core tables in a Pisces schema, this function isn&#8217;t recommended.  
Instead, subclass from the known abstract table.</p>
<p class="rubric">Examples</p>
<p># for unknown table
&gt;&gt;&gt; import pisces.schema.css3 as css
&gt;&gt;&gt; RandomTable = get_tables(engine, [&#8216;randomtable&#8217;])</p>
<p># for a known/prototype table
&gt;&gt;&gt; class Site(css.Site):</p>
<blockquote>
<div>__tablename__ = &#8216;myaccount.my_site_tablename&#8217;</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="pisces.util.make_same_size">
<tt class="descclassname">pisces.util.</tt><tt class="descname">make_same_size</tt><big>(</big><em>lat1</em>, <em>lon1</em>, <em>lat2</em>, <em>lon2</em><big>)</big><a class="reference internal" href="_modules/pisces/util.html#make_same_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pisces.util.make_same_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns numpy arrays the same size as longest inputs.
assume: lat1/lon1 are same size and lat2/lon2 are same size
assume: the smaller of the sizes is a scalar</p>
</dd></dl>

<dl class="function">
<dt id="pisces.util.table_contains_all">
<tt class="descclassname">pisces.util.</tt><tt class="descname">table_contains_all</tt><big>(</big><em>itable</em>, <em>keys</em><big>)</big><a class="reference internal" href="_modules/pisces/util.html#table_contains_all"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pisces.util.table_contains_all" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="pisces.util.travel_times">
<tt class="descclassname">pisces.util.</tt><tt class="descname">travel_times</tt><big>(</big><em>ref</em>, <em>deg=None</em>, <em>km=None</em>, <em>depth=0.0</em><big>)</big><a class="reference internal" href="_modules/pisces/util.html#travel_times"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pisces.util.travel_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Get <em>approximate</em> relative travel time(s).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>ref</strong> : list or tuple of strings and/or floats</p>
<blockquote>
<div><p>Reference phase names or horizontal velocities [km/sec].</p>
</div></blockquote>
<p><strong>deg</strong> : float, optional</p>
<blockquote>
<div><p>Degrees of arc between two points of interest (spherical earth).</p>
</div></blockquote>
<p><strong>km</strong> : float, optional</p>
<blockquote>
<div><p>Horizontal kilometers between two points of interest (spherical earth).</p>
</div></blockquote>
<p><strong>depth</strong> : float, optional. default, 0.</p>
<blockquote>
<div><p>Depth (positive down) of event, in kilometers.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">numpy.ndarray</p>
<blockquote class="last">
<div><p>Relative times, in seconds, same length as &#8220;ref&#8221;. NaN if requested time
is undefined.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Either deg or km must be indicated.
The user is responsible for adding/subtracting time (such as origin
time, pre-window noise time, etc.) from those predicted in order to define 
a window.
Phase travel times use ak135.</p>
<p class="rubric">Examples</p>
<p>Get relative P arrival and 2.7 km/sec surface wave arrival at 35 degrees
distance.
&gt;&gt;&gt; times = travel_times([&#8216;P&#8217;, 2.7], deg=35.0)
To get absolute window, add the origin time like:
&gt;&gt;&gt; w1, w2 = times + epoch_origin_time</p>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="pisces.html">pisces package</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="pisces.io.html">pisces.io package</a></li>
<li class="toctree-l2"><a class="reference internal" href="pisces.schema.html">pisces.schema package</a></li>
<li class="toctree-l2"><a class="reference internal" href="pisces.client.html">pisces.client module</a></li>
<li class="toctree-l2"><a class="reference internal" href="pisces.request.html">pisces.request module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">pisces.util module</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pisces.request.html"
                        title="previous chapter">pisces.request module</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/pisces.util.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pisces.request.html" title="pisces.request module"
             >previous</a> |</li>
        <li><a href="index.html">pisces 0.2.1 documentation</a> &raquo;</li>
          <li><a href="pisces.html" >pisces package</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Jonathan MacCarthy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>